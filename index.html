<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Happy Birthday!</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Montserrat:wght@300;600&display=swap');

        body { 
            font-family: 'Montserrat', sans-serif; 
            text-align: center; 
            background: #0f0c29;
            background: linear-gradient(to bottom, #24243e, #302b63, #0f0c29);
            color: #ffffff;
            margin: 0; 
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
            overflow: hidden;
        }

        .card { 
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(15px);
            padding: 40px 30px; 
            border-radius: 30px; 
            max-width: 400px; 
            width: 100%;
            border: 1px solid rgba(255,255,255,0.1);
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
        }

        /* Cake & Flame */
        .cake-container { position: relative; font-size: 100px; margin: 30px 0; display: inline-block; }
        .flame { position: absolute; top: -45px; left: 50%; transform: translateX(-50%); font-size: 40px; animation: flicker 0.2s infinite alternate; }
        @keyframes flicker { 0% { opacity: 0.8; transform: translateX(-50%) scale(1); } 100% { opacity: 1; transform: translateX(-50%) scale(1.1); } }
        .smoke { display: none; font-size: 40px; position: absolute; top: -45px; left: 50%; transform: translateX(-50%); }

        /* Reveal Section */
        #reveal-section { display: none; animation: fadeInScale 1.2s ease-out forwards; }
        @keyframes fadeInScale {
            0% { opacity: 0; transform: scale(0.9) translateY(20px); }
            100% { opacity: 1; transform: scale(1) translateY(0); }
        }

        .couple-gif {
            width: 100%; max-width: 300px; border-radius: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 0 25px rgba(255, 117, 140, 0.5);
            margin: 20px 0;
        }

        .personal-note {
            font-family: 'Dancing Script', cursive;
            font-size: 2.3rem; color: #ff758c; line-height: 1.2;
            margin-bottom: 15px;
        }

        button { 
            background: #ff4d4d; color: white; border: none; padding: 15px 35px; 
            border-radius: 50px; font-weight: bold; font-size: 1.1rem;
            box-shadow: 0 5px 20px rgba(255, 77, 77, 0.4);
            cursor: pointer;
            transition: transform 0.2s;
        }
        button:active { transform: scale(0.95); }
        
        #status { margin: 20px; color: #ffb3ba; font-style: italic; font-size: 0.9rem; }
    </style>
</head>
<body>

<div class="card">
    <div id="cake-area" class="cake-container">
        <div id="flame" class="flame">ðŸ”¥</div>
        <div id="smoke" class="smoke">ðŸ’¨</div>
        <div class="cake">ðŸŽ‚</div>
    </div>

    <div id="status">Ready to make a wish?</div>
    <button id="micBtn" onclick="startMic()">Make a Wish</button>

    <div id="reveal-section">
        <img src="https://i.postimg.cc/d1J49SrJ/B3ADF171-60F8-4338-AEFF-48209290B665.gif" class="couple-gif" alt="Our Memory">
        
        <div class="personal-note">Happy Birthday, Pu Kyuu Tone! ðŸ’“</div>
        <p style="line-height: 1.6;">Wish you all the happiness and wealth in the world! Keep smiling pu kyu lay. Love you</p>
    </div>
</div>

<script>
    let blownOut = false;

    async function startMic() {
        // Change UI to listening state
        document.getElementById('micBtn').style.display = 'none';
        document.getElementById('status').innerText = "Make a wish and BLOW! ðŸŒ¬ï¸";

        try {
            const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const analyser = audioContext.createAnalyser();
            const microphone = audioContext.createMediaStreamSource(stream);
            const scriptProcessor = audioContext.createScriptProcessor(2048, 1, 1);

            analyser.fftSize = 512;
            microphone.connect(analyser);
            analyser.connect(scriptProcessor);
            scriptProcessor.connect(audioContext.destination);

            scriptProcessor.onaudioprocess = function() {
                const array = new Uint8Array(analyser.frequencyBinCount);
                analyser.getByteFrequencyData(array);
                let volume = array.reduce((a, b) => a + b) / array.length;

                // Threshold for blowing
                if (volume > 45 && !blownOut) {
                    reveal();
                    blownOut = true;
                    // Turn off mic once done
                    stream.getTracks().forEach(t => t.stop());
                }
            };
        } catch (err) {
            // Fallback for no mic permission
            document.getElementById('status').innerText = "Mic blocked? Tap the cake to blow out!";
            document.getElementById('cake-area').onclick = reveal;
        }
    }

    function reveal() {
        document.getElementById('flame').style.display = 'none';
        document.getElementById('smoke').style.display = 'block';
        document.getElementById('status').style.display = 'none';
        document.getElementById('reveal-section').style.display = 'block';
        
        // Instant Confetti Burst
        confetti({
            particleCount: 200,
            spread: 90,
            origin: { y: 0.7 },
            colors: ['#ff758c', '#ffffff', '#ff4d4d', '#ffd700']
        });

        // Extra "Sparkle" fireworks
        setTimeout(() => {
            var end = Date.now() + (2 * 1000);
            (function frame() {
                confetti({ particleCount: 5, angle: 60, spread: 55, origin: { x: 0 }, colors: ['#ff758c'] });
                confetti({ particleCount: 5, angle: 120, spread: 55, origin: { x: 1 }, colors: ['#ffd700'] });
                if (Date.now() < end) requestAnimationFrame(frame);
            }());
        }, 500);
    }
</script>

</body>
</html>
